Tables for poster
=========

Load the Data
-----
First we load the data:

```{r}
library(ProjectTemplate)
library(Hmisc)
library(survey)
library(stargazer)
library(binom)

setwd("~/Dropbox/Mike/CHIS")
load.project()
```

This also runs the script to clean the data, contained within the file `/munge/01-A.R`.

Table 1: Univariates
-------
We want:  
* gender (male)
* birthweight  (brthwk.p.i)
* ethnicity  (srh.a.i)
* race  (racehp2p)
* below poverty level (belowpovl)
* PEDS risk categories (peds)
* age (srage.p)
* uninsured in the last year (unins.ever)
* Developmental specialist referred (cf46)
* speech referred (cf47)
* Referred to either (referred)

### Gender
```{r}
summary(chis$male)
length(chis$male)
binom.confint(sum(chis$male == "Male", na.rm = T), length(!is.na(chis$male)), method = "asym")

svytotal(~male, rchis)
sum(svytotal(~male, rchis))
svymean(~male, rchis)
confint(svymean(~male, rchis))
```

### Age
```{r}
mean(chis$srage.p)
sd(chis$srage.p)
n.age <- length(chis$srage.p)
mean(chis$srage.p) + qt(0.025, n.age)
mean(chis$srage.p) + qt(0.975, n.age)

svymean(~srage.p, rchis)
confint(svymean(~srage.p, rchis))
```

### Birthweight
```{r}
summary(chis$brthwk.p.i)
mean(chis$brthwk.p.i)
sd(chis$brthwk.p.i)
n.bw <- length(chis$brthwk.p.i)
n.bw
mean(chis$brthwk.p.i) + qt(0.025, n.bw)
mean(chis$brthwk.p.i) + qt(0.975, n.bw)

svymean(~brthwk.p.i, rchis)
confint(svymean(~brthwk.p.i, rchis))
```

### PEDS
```{r}
summary(chis$peds)
pedstable <- table(chis$peds)
pedstable
sum(pedstable)
sapply(pedstable, binom.confint, n = sum(pedstable), method = "asy")

svytotal(~peds, rchis, na.rm = T)
sum(svytotal(~peds, rchis, na.rm = T))
svymean(~peds, rchis, na.rm = T)
confint(svymean(~peds, rchis, na.rm = T))
```

### Hispanic Ethnicity
```{r}
summary(chis$srh.a.i)
binom.confint(sum(chis$srh.a.i == "YES"), length(chis$srh.a.i), method = "asym")

svytotal(~srh.a.i, rchis)
sum(svytotal(~srh.a.i, rchis))
svymean(~srh.a.i, rchis)
confint(svymean(~srh.a.i, rchis))

```

### Race
```{r}
summary(chis$racehp2p)
racetable <- table(chis$racehp2p)
racetable
sapply(racetable, binom.confint, n = sum(racetable), method = "asy")

svytotal(~racehp2p, rchis)
sum(svytotal(~racehp2p, rchis))
svymean(~racehp2p, rchis)
confint(svymean(~racehp2p, rchis))
```

### Lack of Insurance
```{r}
ins.table <- table(chis$unins.ever)
ins.table
binom.confint(ins.table[2], sum(ins.table), method = "asym")

svytotal(~unins.ever, rchis, na.rm = T)
sum(svytotal(~unins.ever, rchis, na.rm = T))
svymean(~unins.ever, rchis) 
confint(svymean(~unins.ever, rchis))
```

### Below Poverty Level
```{r}
summary(chis$belowpovl)
length(chis$belowpovl)
binom.confint(sum(chis$belowpovl == "Below 100% FPL", na.rm = T), length(!is.na(chis$belowpovl)), method = "asym")

svytotal(~belowpovl, rchis, na.rm = T)
sum(svytotal(~belowpovl, rchis, na.rm = T))
svymean(~belowpovl, rchis) 
confint(svymean(~belowpovl, rchis))
```


### Referred to Developmental Specialist
```{r}
summary(chis$cf46)
length(chis$cf46)
table(chis$cf46)
sum(table(chis$cf46))
binom.confint(sum(chis$cf46 == "Referred", na.rm = T), sum(table(chis$cf46)), method = "asym")

svytotal(~cf46, rchis, na.rm = T)
sum(svytotal(~cf46, rchis, na.rm = T))
svymean(~cf46, rchis, na.rm = T)
confint(svymean(~cf46, rchis, na.rm = T))
```

### Referred to Speech, Language, Hearing Evaluation
```{r}
summary(chis$cf47)
length(chis$cf47)
table(chis$cf47)
sum(table(chis$cf47))
binom.confint(sum(chis$cf47 == "Referred", na.rm = T), sum(table(chis$cf47)), method = "asym")

svytotal(~cf47, rchis, na.rm = T)
sum(svytotal(~cf47, rchis, na.rm = T))
svymean(~cf47, rchis, na.rm = T)
confint(svymean(~cf47, rchis, na.rm = T))
```

### Referred to either Developmental Specialist or Speech, Language, Hearing Evaluation
```{r}
summary(chis$referred)
length(chis$referred)
table(chis$referred)
sum(table(chis$referred))
binom.confint(sum(chis$referred == "Yes", na.rm = T), sum(table(chis$referred)), method = "asym")

svytotal(~referred, rchis, na.rm = T)
sum(svytotal(~referred, rchis, na.rm = T))
svymean(~referred, rchis, na.rm = T)
confint(svymean(~referred, rchis, na.rm = T))
```

Table 2: Unadjusted Bivariate Comparisons
------
We will want to see what is the rate of referrals among children in each of those categories and whether they are significant. We must use the survey functions for weighting to test the associations.

### Gender
```{r}
svyby(~male, by = ~cf46, design = rchis, FUN = svymean)
svychisq(~male + cf46, rchis, statistic = "Chisq")

svyby(~male, by = ~cf47, design = rchis, FUN = svymean)
svychisq(~male + cf47, rchis, statistic = "Chisq")

svyby(~male, by = ~referred, design = rchis, FUN = svymean)
svychisq(~male + referred, rchis, statistic = "Chisq")
```

### Age
```{r}
svyby(~srage.p, by = ~cf46, design = rchis, FUN = svymean)
svyttest(srage.p ~ cf46, design = rchis)

svyby(~srage.p, by = ~cf47, design = rchis, FUN = svymean)
svyttest(srage.p ~ cf47, design = rchis)

svyby(~srage.p, by = ~referred, design = rchis, FUN = svymean)
svyttest(srage.p ~ referred, design = rchis)
```

### Birthweight
```{r}
svyby(~brthwk.p, by = ~cf46, design = rchis, FUN = svymean, na.rm = T)
svyttest(brthwk.p ~ cf46, design = rchis)

svyby(~brthwk.p, by = ~cf47, design = rchis, FUN = svymean, na.rm = T)
svyttest(brthwk.p ~ cf47, design = rchis)

svyby(~brthwk.p, by = ~referred, design = rchis, FUN = svymean, na.rm = T)
svyttest(brthwk.p ~ referred, design = rchis)
```

### Race
```{r}
svyby(~racehp2p, by = ~cf46, design = rchis, FUN = svymean)
svychisq(~racehp2p + cf46, rchis, statistic = "Chisq")

svyby(~racehp2p, by = ~cf47, design = rchis, FUN = svymean)
svychisq(~racehp2p + cf47, rchis, statistic = "Chisq")

svyby(~racehp2p, by = ~referred, design = rchis, FUN = svymean)
svychisq(~racehp2p + referred, rchis, statistic = "Chisq")
```

### Hispanic Ethnicity
```{r}
svyby(~srh.a.i, by = ~cf46, design = rchis, FUN = svymean)
svychisq(~srh.a.i + cf46, rchis, statistic = "Chisq")

svyby(~srh.a.i, by = ~cf47, design = rchis, FUN = svymean)
svychisq(~srh.a.i + cf47, rchis, statistic = "Chisq")

svyby(~srh.a.i, by = ~referred, design = rchis, FUN = svymean)
svychisq(~srh.a.i + referred, rchis, statistic = "Chisq")
```

### Below Poverty Level
```{r}
svyby(~belowpovl, by = ~cf46, design = rchis, FUN = svymean)
svychisq(~belowpovl + cf46, rchis, statistic = "Chisq")

svyby(~belowpovl, by = ~cf47, design = rchis, FUN = svymean)
svychisq(~belowpovl + cf47, rchis, statistic = "Chisq")

svyby(~belowpovl, by = ~referred, design = rchis, FUN = svymean)
svychisq(~belowpovl + referred, rchis, statistic = "Chisq")
```

### Uninsured Ever in Last Year
```{r}
svyby(~unins.ever, by = ~cf46, design = rchis, FUN = svymean)
svychisq(~unins.ever + cf46, rchis, statistic = "Chisq")

svyby(~unins.ever, by = ~cf47, design = rchis, FUN = svymean)
svychisq(~unins.ever + cf47, rchis, statistic = "Chisq")

svyby(~unins.ever, by = ~referred, design = rchis, FUN = svymean)
svychisq(~unins.ever + referred, rchis, statistic = "Chisq")
```

### PEDS High Risk
```{r}
svyby(~pedsHiRisk, by = ~cf46, design = rchis, FUN = svymean)
svychisq(~pedsHiRisk + cf46, rchis, statistic = "Chisq")

svyby(~pedsHiRisk, by = ~cf47, design = rchis, FUN = svymean)
svychisq(~pedsHiRisk + cf47, rchis, statistic = "Chisq")

svyby(~pedsHiRisk, by = ~referred, design = rchis, FUN = svymean)
svychisq(~pedsHiRisk + referred, rchis, statistic = "Chisq")
```

Table 3: Regression Analyses
-----


### GLM with univariates from univariates_referral_devo.R
```{r}
model2 <- svyglm(cf46 ~ pedsHiRisk 
                 + male 
                 #                + cd1.2 
                 + srage.p 
                 + belowpovl 
                 + unins.ever 
                 + racehp2p 
                 # + white
                 + srh.a.i
                 + brthwk.p.i
                 ,
                 design = rchis, family = quasibinomial)
summary(model2)
cbind(OddsRatio = exp(model2$coef), exp(confint(model2)))
```

### GLM with univariates from univariates_referral_speech-only.R

```{r}
model3 <- svyglm(cf47 ~ pedsHiRisk 
                 + male 
                 #                 + cd1.2 
                 + srage.p 
                 + belowpovl 
                 + unins.ever 
                 + racehp2p 
                 # + white
                 + srh.a.i
                 + brthwk.p.i
                 ,
                 design = rchis, family = quasibinomial)
summary(model3)
cbind(OddsRatio = exp(model3$coef), exp(confint(model3)))
```

### GLM with univariates from univariates.R

```{r}
model1 <- svyglm(referred ~ pedsHiRisk
                # + peds
                + male 
                #                + cd1.2 
                + srage.p 
                + belowpovl 
                + unins.ever 
                + racehp2p 
                #               + white
                + srh.a.i
                + brthwk.p.i
                ,
                design = rchis, family = quasibinomial)
summary(model1)
cbind(OddsRatio = exp(model1$coef), exp(confint(model1)))
```