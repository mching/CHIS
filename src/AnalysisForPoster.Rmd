Tables for poster
=========

Load the Data
-----
First we load the data:

```{r}
library(ProjectTemplate)
library(Hmisc)
library(survey)
library(stargazer)
library(binom)

setwd("~/Dropbox/Mike/CHIS")
load.project()
```

This also runs the script to clean the data, contained within the file `/munge/01-A.R`.

Table 1: Univariates
-------
We want:  
* gender (male)
* birthweight  (brthwk.p.i)
* ethnicity  (srh.a.i)
* race  (racehp2p)
* PEDS risk categories (peds)
* age (srage.p)
* uninsured in the last year (unins.ever)
* Developmental specialist referred (cf46)
* speech referred (cf47)
* Referred to either (referred)

Create a new dataframe to hold just these variables
```{r}
Table1.frame <- with(chis, data.frame(brthwk.p.i, racehp2p, srh.a.i, male, peds, srage.p, unins.ever, cf46, cf47, referred))
head(Table1.frame)
summary(Table1.frame)
```

### Gender
```{r}
summary(Table1.frame$male)
length(Table1.frame$male)
binom.confint(sum(Table1.frame$male == "Male", na.rm = T), length(!is.na(Table1.frame$male)), method = "asym")
```

### Age
```{r}
mean(Table1.frame$srage.p)
sd(Table1.frame$srage.p)
n.age <- length(Table1.frame$srage.p)
mean(Table1.frame$srage.p) + qt(0.025, n.age)
mean(Table1.frame$srage.p) + qt(0.975, n.age)
```

### Birthweight
```{r}
summary(Table1.frame$brthwk.p.i)
mean(Table1.frame$brthwk.p.i)
sd(Table1.frame$brthwk.p.i)
n.bw <- length(Table1.frame$brthwk.p.i)
n.bw
mean(Table1.frame$brthwk.p.i) + qt(0.025, n.bw)
mean(Table1.frame$brthwk.p.i) + qt(0.975, n.bw)
```

### PEDS
```{r}
summary(Table1.frame$peds)
pedstable <- table(Table1.frame$peds)
pedstable
sum(pedstable)
sapply(pedstable, binom.confint, n = sum(pedstable), method = "asy")
```

### Hispanic Ethnicity
```{r}
summary(Table1.frame$srh.a.i)
binom.confint(sum(Table1.frame$srh.a.i == "YES"), length(Table1.frame$srh.a.i), method = "asym")
```

### Race
```{r}
summary(Table1.frame$racehp2p)
racetable <- table(Table1.frame$racehp2p)
racetable
sapply(racetable, binom.confint, n = sum(racetable), method = "asy")
```

### Lack of Insurance
```{r}
ins.table <- table(Table1.frame$unins.ever)
ins.table
binom.confint(ins.table[2], sum(ins.table), method = "asym")
```


### Referred to Developmental Specialist
```{r}
summary(Table1.frame$cf46)
length(Table1.frame$cf46)
table(Table1.frame$cf46)
sum(table(Table1.frame$cf46))
binom.confint(sum(Table1.frame$cf46 == "Referred", na.rm = T), sum(table(Table1.frame$cf46)), method = "asym")
```

### Referred to Speech, Language, Hearing Evaluation
```{r}
summary(Table1.frame$cf47)
length(Table1.frame$cf47)
table(Table1.frame$cf47)
sum(table(Table1.frame$cf47))
binom.confint(sum(Table1.frame$cf47 == "Referred", na.rm = T), sum(table(Table1.frame$cf47)), method = "asym")
```

### Referred to either Developmental Specialist or Speech, Language, Hearing Evaluation
```{r}
summary(Table1.frame$referred)
length(Table1.frame$referred)
table(Table1.frame$referred)
sum(table(Table1.frame$referred))
binom.confint(sum(Table1.frame$referred == "Yes", na.rm = T), sum(table(Table1.frame$referred)), method = "asym")
```

Table 2: Unadjusted Bivariate Comparisons
------
We will want to see what is the rate of referrals among children in each of those categories and whether they are significant. We must use the survey functions for weighting to test the associations.

### Gender
```{r}
svyby(~male, by = ~cf46, design = rchis, FUN = svymean)
svychisq(~male + cf46, rchis, statistic = "Chisq")

svyby(~male, by = ~cf47, design = rchis, FUN = svymean)
svychisq(~male + cf47, rchis, statistic = "Chisq")

svyby(~male, by = ~referred, design = rchis, FUN = svymean)
svychisq(~male + referred, rchis, statistic = "Chisq")
```

### Age
```{r}
svyby(~srage.p, by = ~cf46, design = rchis, FUN = svymean)
svyttest(srage.p ~ cf46, design = rchis)

svyby(~srage.p, by = ~cf47, design = rchis, FUN = svymean)
svyttest(srage.p ~ cf47, design = rchis)

svyby(~srage.p, by = ~referred, design = rchis, FUN = svymean)
svyttest(srage.p ~ referred, design = rchis)
```

### Birthweight
```{r}
svyby(~brthwk.p, by = ~cf46, design = rchis, FUN = svymean, na.rm = T)
svyttest(brthwk.p ~ cf46, design = rchis)

svyby(~brthwk.p, by = ~cf47, design = rchis, FUN = svymean, na.rm = T)
svyttest(brthwk.p ~ cf47, design = rchis)

svyby(~brthwk.p, by = ~referred, design = rchis, FUN = svymean, na.rm = T)
svyttest(brthwk.p ~ referred, design = rchis)
```

### Race
```{r}
svyby(~racehp2p, by = ~cf46, design = rchis, FUN = svymean)
svychisq(~racehp2p + cf46, rchis, statistic = "Chisq")

svyby(~racehp2p, by = ~cf47, design = rchis, FUN = svymean)
svychisq(~racehp2p + cf47, rchis, statistic = "Chisq")

svyby(~racehp2p, by = ~referred, design = rchis, FUN = svymean)
svychisq(~racehp2p + referred, rchis, statistic = "Chisq")
```

### Hispanic Ethnicity
```{r}
svyby(~srh.a.i, by = ~cf46, design = rchis, FUN = svymean)
svychisq(~srh.a.i + cf46, rchis, statistic = "Chisq")

svyby(~srh.a.i, by = ~cf47, design = rchis, FUN = svymean)
svychisq(~srh.a.i + cf47, rchis, statistic = "Chisq")

svyby(~srh.a.i, by = ~referred, design = rchis, FUN = svymean)
svychisq(~srh.a.i + referred, rchis, statistic = "Chisq")
```

### Uninsured Ever in Last Year
```{r}
svyby(~unins.ever, by = ~cf46, design = rchis, FUN = svymean)
svychisq(~unins.ever + cf46, rchis, statistic = "Chisq")

svyby(~unins.ever, by = ~cf47, design = rchis, FUN = svymean)
svychisq(~unins.ever + cf47, rchis, statistic = "Chisq")

svyby(~unins.ever, by = ~referred, design = rchis, FUN = svymean)
svychisq(~unins.ever + referred, rchis, statistic = "Chisq")
```

### PEDS High Risk
```{r}
svyby(~pedsHiRisk, by = ~cf46, design = rchis, FUN = svymean)
svychisq(~pedsHiRisk + cf46, rchis, statistic = "Chisq")

svyby(~pedsHiRisk, by = ~cf47, design = rchis, FUN = svymean)
svychisq(~pedsHiRisk + cf47, rchis, statistic = "Chisq")

svyby(~pedsHiRisk, by = ~referred, design = rchis, FUN = svymean)
svychisq(~pedsHiRisk + referred, rchis, statistic = "Chisq")
```